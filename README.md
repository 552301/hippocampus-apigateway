## API网关设计

### （一）性能数据采集服务
**模块：apigateway-performance-collection** 

**模块简介：**
该模块实现了RPC接口与REST接口的调用时长和调用次数的采集与持久化
该性能数据采集服务每一分钟就会统计这一分钟内所有被调用接口的次数与平均调用时长，并打印到进程的日志里。

**设计细节：**
- 业务线程会把本地调用的记录提交到任务队列中，采集线程会从任务队列中消费调用记录，并根据记录中的API字段进行路由，提交给对应的计算节点来处理。
- 性能指标持久化服务每分钟会向所有的计算节点提交持久化的任务，要求将这一分钟内所有被调用接口的性能数据打印到日志中，同时清空内存中的统计数据，让计算节点从零开始统计下一分钟的接口性能数据。

**服务特点：**
- 通过任务队列解耦了业务服务与采集服务，采集服务不会影响业务服务的运行。
- 考虑到不同接口的数据是不相关的，所以进行了分片的处理，引入了计算节点的概念。每个计算节点都持有一个任务队列，一个消费线程和性能数据的一个分片。计算节点的数量就是整个服务的并发度。
这种分片+串行执行统计任务和持久化任务的方式让整个服务实现了无锁的操作。



### （二）泛化调用网关
**模块：apigateway-rpc-genericinvoke**

**模块简介：**
该模块实现了泛化调用网关。网关对外提供了一个REST API接口，客户端通过调用该REST API就能调用RPC服务方提供的所有RPC接口。

### （三）限流功能
**模块：apigateway-flowlimit**



